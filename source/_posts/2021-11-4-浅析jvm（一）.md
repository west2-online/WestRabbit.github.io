---
title: <浅析JVM原理>
date: <2021/10/21>
tags: 
    - <19级>
    - <JAVA>
author: <summer>
---

# 浅析Jvm原理之路（一）



## Jvm基础

## jdk jre jvm区别

相信大家学习java都听说过jdk，jre，jvm但具体这三者是什么又有什么区别呢？

其实jvm（java virtual machine）是java程序运行的虚拟机也就是Java二进制字节码的运行环境，jre(java runtime environment) 是java运行环境也就是在jre的基础上加上核心类库，这些类库就是jvm解释class的时候所需要的类库lib，在jdk的安装目录里你可以找到jre目录，里面有两个文件夹bin和lib，jdk(java development kit) 是在jre的基础上加上java的基础类库和开发工具例如编译器、调试器等。

或者用一张图来表示：

![image-20211104183543694](C:\Users\11075\AppData\Roaming\Typora\typora-user-images\image-20211104183543694.png)

注：图来自https://www.cnblogs.com/bingyimeiling/p/10266949.html，作者冰湖一角

## jvm结构

![image-20211104184109177](C:\Users\11075\AppData\Roaming\Typora\typora-user-images\image-20211104184109177.png)

注：图来自https://blog.csdn.net/ago_lei/article/details/88786176



### 内存区域

#### 程序计数器

程序计数器也就是jvm在进行过程中记录下一条jvm指令的地址，需要注意的是程序计数器是线程私有的，且不存在内存溢出问题

#### 虚拟机栈

虚拟机栈也就是线程运行需要的内存空间，堆栈的数据结构相信大家都有所了解，为先进后出原则。且虚拟机栈的单位为栈帧。即入栈出栈都以一个栈帧为单位。

栈帧：每个方法运行时需要的内存，其中：有函数的参数，局部变量，返回地址等等。。。。

活动栈帧：虚拟机栈的最顶部同时每一个线程只能由有一个活动栈帧，也对应着当前正在执行的方法。

需要注意的是，虚拟机栈不涉及垃圾回收。



##### 那么问题来了，那栈帧内一个个的局部变量是否是线程安全的呢？

答案是不一定的，如果方法内的局部变量没有逃离方法的作用访问，它就是安全的。简单来说，静态变量大家都知道是线程共享的肯定不安全，如果局部变量引用了对象，并且逃离了方法的作用范围，例如作为地址返回就有可能被多个线程同时调用，就需要考虑安全问题



##### 虚拟机栈的内存溢出问题

内存溢出，java程序会抛出一个叫做StackOverFlowError 异常，通常有以下两种情况

1）栈帧过多

2）栈帧过大（不太可能出现）



栈帧过多有许多场景最经典的就是无限的递归调用，一个个方法栈帧入栈就导致栈帧过多大于虚拟机栈的容量抛出StackOverError大家可以自己写个无限递归的程序尝试下，还有一个就是类来回引用json转化也会导致栈帧过多。



#### 本地方法栈

c或者c++实现，给本地方法运行提供内存空间



以上介绍的jvm内存区域的程序计数器，虚拟机栈，本地方法栈都是线程私有的，接下来介绍的堆，方法区都是线程共享的，我们下次介绍。。。。







